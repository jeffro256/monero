// Copyright (c) 2024, The Monero Project
//
// All rights reserved.
//
// Redistribution and use in source and binary forms, with or without modification, are
// permitted provided that the following conditions are met:
//
// 1. Redistributions of source code must retain the above copyright notice, this list of
//    conditions and the following disclaimer.
//
// 2. Redistributions in binary form must reproduce the above copyright notice, this list
//    of conditions and the following disclaimer in the documentation and/or other
//    materials provided with the distribution.
//
// 3. Neither the name of the copyright holder nor the names of its contributors may be
//    used to endorse or promote products derived from this software without specific
//    prior written permission.
//
// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY
// EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
// MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL
// THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
// SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
// INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,
// STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF
// THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

#pragma once

#include <limits>

#include "cryptonote_config.h"
#include "fcmp_pp_rust/fcmp++.h"

namespace fcmp_pp
{
//----------------------------------------------------------------------------------------------------------------------

static_assert(FCMP_PLUS_PLUS_MAX_INPUTS == 8, "FCMP++ proof len table expects max 8 inputs");

// Constructed using ::_slow_fcmp_proof_size
// Most of the values in this table aren't realistic (way more layers than ever expected in an honest tx). We place them
// in the table to not over-complicate the protocol (by restricting n layers), and to prevent a malicious actor from
// causing a node to have to slowly de-serialize a fake tx with a higher number of layers.
static const uint32_t PROOF_LEN_TABLE[FCMP_PLUS_PLUS_MAX_INPUTS][std::numeric_limits<uint8_t>::max()]
{
    {2880, 3296, 3520, 4064, 4416, 4832, 5056, 5600, 5248, 4768, 4960, 5312, 5504, 5728, 5920, 6272, 5952, 5440, 5472, 5664, 5856, 6048, 6208, 6400, 6592, 6784, 6816, 7008, 7200, 7392, 7552, 7744, 7936, 7424, 7456, 7488, 7168, 7360, 7520, 7680, 7872, 8064, 8096, 8128, 8288, 8480, 8512, 8672, 8864, 9056, 9216, 9248, 9280, 9472, 9632, 9792, 9984, 10176, 10208, 10240, 10400, 10592, 10624, 10784, 10976, 10464, 10624, 10656, 10688, 10848, 11008, 11040, 11232, 11424, 11456, 11616, 11296, 11328, 11488, 11648, 11680, 11872, 12032, 12064, 12096, 12256, 12416, 12448, 12640, 12832, 12864, 13024, 13184, 13216, 13248, 13408, 13568, 13760, 13792, 13824, 13984, 14144, 14176, 14208, 14400, 14592, 14752, 14912, 14944, 14976, 15136, 15296, 15328, 15520, 15680, 15712, 15744, 15904, 16064, 16096, 16288, 16480, 16512, 16672, 16832, 16864, 16896, 17056, 17216, 16704, 16736, 16768, 16928, 17088, 17120, 17152, 17344, 17504, 17664, 17696, 17728, 17888, 18048, 18080, 18112, 18304, 18464, 18624, 18656, 18688, 18848, 19008, 19200, 19232, 18912, 19072, 19104, 19136, 19296, 19456, 19488, 19680, 19840, 19872, 19904, 20064, 20224, 20256, 20288, 20448, 20608, 20640, 20672, 20832, 20992, 21024, 21056, 21248, 21408, 21568, 21600, 21632, 21792, 21952, 22144, 22176, 22208, 22368, 22528, 22560, 22592, 22752, 22912, 23104, 23136, 23168, 23328, 23488, 23520, 23552, 23712, 23872, 23904, 23936, 24096, 24256, 24288, 24320, 24480, 24672, 24704, 24864, 25024, 25056, 25088, 25248, 25440, 25472, 25632, 25792, 25824, 25856, 26016, 26176, 26208, 26400, 26560, 26592, 26624, 26784, 26944, 26976, 27008, 27168, 27328, 27360, 27392, 27552, 27712, 27744, 27776, 27968, 28128, 28288, 28320, 28352, 28512, 28672, 28864, 28896, 28928, 29088, 29248, 29280, 29312, },
    {3680, 4640, 4288, 5120, 5632, 5376, 5888, 6336, 6144, 5696, 6048, 6432, 6784, 7040, 7392, 7776, 7616, 7136, 7328, 7552, 7904, 8256, 8320, 8672, 9024, 9248, 9440, 9664, 10016, 10368, 10432, 10784, 11136, 10656, 10848, 11040, 10752, 11104, 11296, 11488, 11840, 12064, 12256, 12448, 12640, 12864, 13184, 13248, 13600, 13952, 14016, 14336, 14400, 14752, 14944, 15136, 15488, 15712, 15904, 16096, 16288, 16512, 16832, 16896, 17248, 16896, 16960, 17280, 17344, 17664, 17728, 18048, 18272, 18496, 18816, 18880, 18720, 18912, 19104, 19296, 19488, 19840, 19904, 20224, 20288, 20608, 20672, 20992, 21216, 21440, 21760, 21824, 22144, 22208, 22528, 22592, 22912, 23136, 23328, 23520, 23712, 23904, 24096, 24288, 24512, 24864, 25056, 25248, 25440, 25632, 25824, 26016, 26208, 26560, 26624, 26944, 27008, 27328, 27392, 27712, 27936, 28160, 28480, 28544, 28864, 28928, 29248, 29312, 29632, 29152, 29344, 29536, 29728, 29920, 30112, 30304, 30528, 30848, 30912, 31232, 31296, 31616, 31680, 32000, 32064, 32416, 32608, 32800, 32992, 33184, 33376, 33568, 33920, 33984, 33824, 34016, 34208, 34400, 34592, 34784, 34976, 35328, 35392, 35712, 35776, 36096, 36160, 36480, 36544, 36864, 36928, 37248, 37312, 37632, 37696, 38016, 38080, 38432, 38624, 38816, 39008, 39200, 39392, 39584, 39936, 40000, 40320, 40384, 40704, 40768, 41088, 41152, 41472, 41696, 41888, 42080, 42272, 42464, 42656, 42848, 43040, 43232, 43424, 43616, 43808, 44000, 44192, 44384, 44576, 44800, 45120, 45184, 45504, 45568, 45888, 45952, 46304, 46496, 46688, 46880, 47072, 47264, 47456, 47648, 47840, 48192, 48256, 48576, 48640, 48960, 49024, 49344, 49408, 49728, 49792, 50112, 50176, 50496, 50560, 50880, 50944, 51296, 51488, 51680, 51872, 52064, 52256, 52448, 52800, 52864, 53184, 53248, 53568, 53632, 53952, },
    {3360, 4736, 5312, 5728, 5408, 5472, 6016, 6592, 6976, 7552, 7424, 7136, 7360, 7904, 8288, 8672, 9056, 9472, 9856, 10240, 10592, 10432, 10816, 11040, 10912, 11296, 11520, 11904, 12256, 12640, 13024, 13376, 13600, 13984, 14368, 14752, 15104, 15488, 15712, 15936, 16320, 16704, 17056, 16736, 16960, 17312, 17696, 17920, 18272, 18656, 18528, 18880, 19104, 19488, 19840, 20064, 20448, 20800, 21024, 21408, 21760, 21984, 22208, 22560, 22912, 23296, 23680, 23904, 24128, 24512, 24864, 25216, 25440, 25664, 26016, 26400, 26624, 26976, 27360, 27584, 27936, 28320, 28544, 28896, 29248, 28928, 29152, 29376, 29760, 30112, 30464, 30688, 30912, 31264, 31616, 31840, 32064, 32448, 32832, 33184, 33536, 33760, 33632, 33984, 34208, 34432, 34784, 35168, 35392, 35744, 36096, 36320, 36544, 36896, 37248, 37472, 37696, 38080, 38432, 38784, 39168, 39392, 39616, 39968, 40320, 40544, 40768, 41120, 41472, 41856, 42080, 42304, 42656, 43008, 43232, 43456, 43808, 44160, 44384, 44768, 45120, 45344, 45728, 46080, 46304, 46528, 46880, 47232, 47456, 47840, 48192, 48416, 48640, 48992, 49344, 49568, 49792, 50144, 50496, 50720, 50944, 51328, 51712, 52064, 52416, 52640, 52864, 53216, 53568, 53792, 54016, 53696, 54048, 54400, 54624, 54848, 55200, 55552, 55776, 56000, 56352, 56704, 56928, 57152, 57536, 57888, 58240, 58464, 58688, 59040, 59392, 59616, 59840, 60224, 60576, 60928, 61152, 61376, 61728, 62080, 62304, 62528, 62880, 63232, 63456, 63680, 64064, 64416, 64288, 64512, 64864, 65216, 65440, 65824, 66176, 66400, 66624, 66976, 67328, 67552, 67776, 68128, 68480, 68704, 68928, 69280, 69632, 69856, 70080, 70432, 70784, 71008, 71232, 71584, 71936, 72320, 72544, 72768, 73120, 73472, 73696, 73920, 74272, 74624, 74848, 75072, 75424, 75776, 76160, 76384, 76608, 76960, 77312, 77536, 77760, },
    {3744, 5664, 5504, 5824, 6528, 6464, 7168, 7808, 7808, 7552, 8096, 8672, 9216, 9664, 10208, 10784, 10816, 10528, 10912, 11328, 11872, 12416, 12672, 13216, 13760, 14176, 14560, 14976, 15520, 16064, 16320, 16864, 17408, 17120, 17504, 17888, 17792, 18336, 18720, 19104, 19648, 20064, 20448, 20832, 21216, 21632, 22144, 22400, 22944, 23488, 23744, 24256, 24512, 25056, 25440, 25824, 26368, 26784, 27168, 27552, 27936, 28352, 28864, 29120, 29664, 29504, 29760, 30272, 30528, 31040, 31296, 31808, 32224, 32640, 33152, 33408, 33440, 33824, 34208, 34592, 34976, 35520, 35776, 36288, 36544, 37056, 37312, 37824, 38240, 38656, 39168, 39424, 39936, 40192, 40704, 40960, 41472, 41888, 42272, 42656, 43040, 43424, 43808, 44192, 44608, 45152, 45536, 45920, 46304, 46688, 47072, 47456, 47840, 48384, 48640, 49152, 49408, 49920, 50176, 50688, 51104, 51520, 52032, 52288, 52800, 53056, 53568, 53824, 54336, 54048, 54432, 54816, 55200, 55584, 55968, 56352, 56768, 57280, 57536, 58048, 58304, 58816, 59072, 59584, 59840, 60384, 60768, 61152, 61536, 61920, 62304, 62688, 63232, 63488, 63520, 63904, 64288, 64672, 65056, 65440, 65824, 66368, 66624, 67136, 67392, 67904, 68160, 68672, 68928, 69440, 69696, 70208, 70464, 70976, 71232, 71744, 72000, 72544, 72928, 73312, 73696, 74080, 74464, 74848, 75392, 75648, 76160, 76416, 76928, 77184, 77696, 77952, 78464, 78880, 79264, 79648, 80032, 80416, 80800, 81184, 81568, 81952, 82336, 82720, 83104, 83488, 83872, 84256, 84640, 85056, 85568, 85824, 86336, 86592, 87104, 87360, 87904, 88288, 88672, 89056, 89440, 89824, 90208, 90592, 90976, 91520, 91776, 92288, 92544, 93056, 93312, 93824, 94080, 94592, 94848, 95360, 95616, 96128, 96384, 96896, 97152, 97696, 98080, 98464, 98848, 99232, 99616, 100000, 100544, 100800, 101312, 101568, 102080, 102336, 102848, },
    {4288, 5728, 5408, 6016, 6784, 7744, 7616, 7680, 8256, 9024, 9600, 10208, 10816, 10848, 10880, 11456, 11872, 12480, 13056, 13632, 14208, 14784, 15328, 15904, 16480, 16512, 16928, 17344, 17408, 17984, 18560, 19104, 19648, 20224, 20640, 21216, 21792, 22208, 22752, 23328, 23744, 24320, 24864, 25408, 25984, 26560, 26976, 27392, 27936, 28512, 29088, 28960, 29376, 29920, 30464, 30880, 31456, 32032, 32448, 32992, 33056, 33472, 34016, 34560, 34976, 35552, 36096, 36512, 37088, 37632, 38048, 38624, 39168, 39584, 40000, 40544, 41088, 41664, 42080, 42496, 43040, 43584, 44160, 44736, 45152, 45568, 46112, 46656, 47072, 47648, 48192, 48608, 49024, 49568, 50144, 50560, 51104, 51680, 52096, 52640, 53184, 53600, 54016, 53888, 54432, 54976, 55392, 55808, 56384, 56928, 57472, 57888, 58304, 58848, 59392, 59968, 60384, 60800, 61344, 61888, 62464, 62880, 63296, 63840, 63904, 64320, 64864, 65408, 65824, 66400, 66944, 67360, 67776, 68320, 68864, 69280, 69696, 70240, 70784, 71200, 71616, 72192, 72736, 73280, 73696, 74112, 74688, 75232, 75776, 76192, 76608, 77152, 77696, 78272, 78688, 79104, 79648, 80192, 80608, 81024, 81568, 82112, 82528, 82944, 83488, 84032, 84448, 85024, 85568, 85984, 86400, 86944, 87520, 87936, 88480, 89024, 89440, 89856, 90400, 90976, 91392, 91936, 92480, 92896, 93312, 93856, 94400, 94816, 95232, 95776, 96320, 96736, 97152, 97728, 98272, 98816, 99392, 99808, 100224, 100768, 101312, 101728, 102144, 102688, 103232, 103104, 103520, 103936, 104480, 105024, 105440, 105856, 106400, 106944, 107360, 107776, 108320, 108864, 109280, 109696, 110240, 110784, 111360, 111776, 112192, 112736, 113280, 113696, 114112, 114656, 115200, 115776, 116192, 116608, 117152, 117696, 118112, 118528, 119072, 119616, 120032, 120448, 120992, 121536, 121952, 122368, 122912, 123456, 124032, 124448, 124512, 125056, 125472, 125888, 126432, },
    {3424, 5216, 6144, 6656, 6688, 7104, 7744, 8672, 9408, 10208, 10304, 10496, 10944, 11840, 12448, 13056, 13792, 14560, 15296, 15904, 16480, 16544, 17152, 17856, 17952, 18560, 19264, 19872, 20448, 21056, 21792, 22368, 22944, 23680, 24288, 24896, 25600, 26208, 26784, 27360, 27968, 28704, 29280, 29312, 29760, 30464, 31072, 31648, 32224, 32832, 33056, 33632, 34208, 34944, 35392, 36096, 36704, 37280, 37856, 38464, 39168, 39616, 40320, 40768, 41472, 42080, 42688, 43392, 43840, 44576, 45152, 45728, 46304, 46880, 47456, 48192, 48640, 49344, 49952, 50528, 51104, 51712, 52416, 52864, 53568, 53472, 54048, 54624, 55232, 55936, 56384, 57088, 57536, 58240, 58688, 59392, 59840, 60576, 61312, 61760, 62464, 62912, 63136, 63712, 64288, 64864, 65440, 66176, 66624, 67328, 67776, 68480, 68928, 69632, 70080, 70784, 71232, 71968, 72544, 73120, 73856, 74304, 75008, 75456, 76160, 76608, 77312, 77760, 78464, 79072, 79648, 80224, 80800, 81376, 81952, 82528, 83104, 83680, 84256, 84864, 85568, 86016, 86752, 87328, 87904, 88480, 89056, 89632, 90208, 90944, 91392, 92096, 92544, 93248, 93696, 94400, 94848, 95552, 96000, 96704, 97152, 97888, 98624, 99072, 99776, 100224, 100928, 101376, 102080, 102528, 103232, 103136, 103712, 104288, 104864, 105440, 106016, 106592, 107168, 107744, 108320, 108896, 109472, 110048, 110656, 111360, 111808, 112512, 112960, 113664, 114112, 114816, 115264, 116000, 116576, 117152, 117728, 118304, 118880, 119456, 120032, 120608, 121184, 121760, 122336, 122912, 123648, 124096, 124320, 124896, 125472, 126048, 126624, 127360, 127808, 128512, 128960, 129664, 130112, 130816, 131264, 131968, 132416, 133120, 133568, 134272, 134720, 135424, 135872, 136576, 137024, 137728, 138176, 138880, 139328, 140064, 140640, 141216, 141792, 142368, 142944, 143520, 144096, 144672, 145248, 145824, 146400, 146976, 147712, 148160, 148864, 149312, 150016, 150464, 151168, },
    {3616, 5632, 5856, 6656, 7456, 7904, 8832, 9792, 9888, 10144, 10912, 11712, 12480, 13408, 14176, 14944, 15680, 16480, 17248, 17312, 17568, 18336, 18944, 19712, 20480, 21248, 21984, 22752, 23520, 24288, 24896, 25632, 26368, 27136, 27904, 28672, 29280, 29344, 30112, 30720, 31456, 32224, 32480, 33216, 33824, 34592, 35360, 35968, 36704, 37440, 38048, 38816, 39552, 40160, 40768, 41536, 42304, 43040, 43776, 44544, 45152, 45760, 46496, 47232, 47840, 48608, 49376, 49984, 50720, 51488, 52096, 52832, 53568, 53632, 54400, 55008, 55616, 56352, 57088, 57696, 58304, 59040, 59776, 60544, 61312, 61920, 62528, 63264, 63520, 64128, 64864, 65632, 66240, 66976, 67712, 68320, 68928, 69664, 70400, 71008, 71616, 72384, 73152, 73888, 74624, 75232, 75840, 76576, 77312, 78080, 78688, 79296, 80032, 80768, 81376, 81984, 82720, 83456, 84064, 84832, 85600, 86208, 86944, 87680, 88288, 88896, 89632, 90368, 90976, 91744, 92480, 93088, 93696, 94432, 95168, 95776, 96384, 97152, 97920, 98656, 99392, 100000, 100608, 101344, 102080, 102688, 103296, 103360, 104096, 104832, 105440, 106048, 106784, 107520, 108128, 108736, 109504, 110240, 110976, 111584, 112192, 112928, 113664, 114272, 114880, 115648, 116384, 117120, 117728, 118336, 119072, 119808, 120416, 121024, 121792, 122528, 123264, 123872, 124128, 124864, 125472, 126080, 126816, 127584, 128192, 128928, 129664, 130272, 130880, 131616, 132352, 132960, 133568, 134304, 135040, 135648, 136256, 136992, 137728, 138336, 138944, 139712, 140448, 141184, 141792, 142400, 143136, 143872, 144480, 145088, 145824, 146560, 147328, 147936, 148544, 149280, 150016, 150624, 151232, 152000, 152736, 153472, 154080, 154688, 155424, 156160, 156768, 157376, 158112, 158848, 159456, 160064, 160800, 161536, 162144, 162752, 163488, 164256, 164864, 165600, 166336, 166944, 167552, 168288, 169024, 169632, 170240, 170976, 171744, 172352, 173088, 173824, 174432, 175040, 175776, },
    {3808, 6176, 6400, 7104, 8192, 8512, 9600, 10624, 11008, 11136, 12064, 13024, 13952, 14784, 15712, 16672, 17088, 17184, 17952, 18752, 19680, 20608, 21248, 22176, 23104, 23904, 24672, 25472, 26400, 27328, 27968, 28896, 29824, 29920, 30688, 31456, 31744, 32672, 33440, 34208, 35136, 35936, 36704, 37472, 38240, 39040, 39936, 40576, 41504, 42432, 43072, 43968, 44608, 45536, 46304, 47072, 48000, 48800, 49568, 50336, 51104, 51904, 52800, 53440, 54368, 54592, 55232, 56128, 56768, 57664, 58304, 59200, 60000, 60800, 61696, 62336, 62752, 63520, 64288, 65056, 65824, 66752, 67392, 68288, 68928, 69824, 70464, 71360, 72160, 72960, 73856, 74496, 75392, 76032, 76928, 77568, 78464, 79264, 80032, 80800, 81568, 82336, 83104, 83872, 84672, 85600, 86368, 87136, 87904, 88672, 89440, 90208, 90976, 91904, 92544, 93440, 94080, 94976, 95616, 96512, 97312, 98112, 99008, 99648, 100544, 101184, 102080, 102720, 103616, 103712, 104480, 105248, 106016, 106784, 107552, 108320, 109120, 110016, 110656, 111552, 112192, 113088, 113728, 114624, 115264, 116192, 116960, 117728, 118496, 119264, 120032, 120800, 121728, 122368, 122784, 123552, 124320, 125088, 125856, 126624, 127392, 128320, 128960, 129856, 130496, 131392, 132032, 132928, 133568, 134464, 135104, 136000, 136640, 137536, 138176, 139072, 139712, 140640, 141408, 142176, 142944, 143712, 144480, 145248, 146176, 146816, 147712, 148352, 149248, 149888, 150784, 151424, 152320, 153120, 153888, 154656, 155424, 156192, 156960, 157728, 158496, 159264, 160032, 160800, 161568, 162336, 163104, 163872, 164640, 165440, 166336, 166976, 167872, 168512, 169408, 170048, 170976, 171744, 172512, 173280, 174048, 174816, 175584, 176352, 177120, 178048, 178688, 179584, 180224, 181120, 181760, 182656, 183296, 184192, 184832, 185728, 186368, 187264, 187904, 188800, 189440, 190368, 191136, 191904, 192672, 193440, 194208, 194976, 195904, 196544, 197440, 198080, 198976, 199616, 200512, },
};

// Size of the membership proof alone
std::size_t fcmp_proof_len(const std::size_t n_inputs, const uint8_t n_layers);

// Size of the FCMP++ proof (membership proof + spend-auth + linkability proofs & input tuples)
// https://github.com/kayabaNerve/fcmp-plus-plus/blob/78754718faa21f0a5751fbd30c9495d7f7f5c2b1/networks/monero/ringct/fcmp%2B%2B/src/lib.rs#L273-L274
std::size_t fcmp_pp_proof_len(const std::size_t n_inputs, const uint8_t n_layers);

//----------------------------------------------------------------------------------------------------------------------
}//namespace fcmp_pp
